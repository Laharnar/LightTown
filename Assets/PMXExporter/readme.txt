PMXExporter v0.3.4 by Furia

・概要
VRMprefabをPMXファイルに出力することができます。

・利用許諾
本スクリプト及び同梱物において特筆される指定が無い限り
MITlicenseを適用します。同梱のLICENSE.txtを参照ください。

UniVRM : MITlicense
author
 DWANGO Co., Ltd. for UniVRM
 ousttrue for UniGLTF, UniHumanoid
 Masataka SUMI for MToon
libraryを参照しています。

MMDataIO : MITlicense
author
 Zyando
libraryを改変・利用しています。

モーフリネームテーブル
author
 側近Q

敬称略

・本スクリプト自体のlicense設定の解説
v0.3以後、libraryへの修正はUnityEngineへの最適化のみとなり、v0.2.4以前の改修コードが排除されました。よってv0.3ではMITlicenseを適用します。
旧版を利用の場合は、旧版のライセンスに従ってください。


・出力されるPMXファイルのライセンス等
プログラムの著作権としての性質及び、リソースはVRMprefabを基に得られるものであるため、出力されるPMXファイルへ本プラグイン自体のライセンスの影響は一切発生しません。
よって出力されたPMXファイルは元となったVRMファイルの複製翻案となり、VRMファイルへ設定されたlicenseに基づきPMXファイルのライセンスが決定されます。

改変を伴う機能であるため、CC_??_NDなど改変禁止指定されたVRMファイルのPMX変換目的での利用は本プラグインのlicenseと適合しません。よって利用できません注意ください。


・利用方法

◆PMXExporter
UniVRMを用いてAssetにVRMをドロップしVRMprefabを作成します。

hierarchyに配置したVRMのprefabへPMXExporterをスクリプトコンポーネントとして付与してください。

右クリックよりExportを選択。
保存先を決定すると出力されます。

※出力されるファイルの留意事項
テクスチャの透過順序は考慮していないのでPMXEditorで修正してください。
後述の機能にも目を通してください。


◇設定
・Replace Bone Name(Default on)
一部基幹ヒューマノイドボーンをMMD標準ボーン名に置換します。

・Convert Armatuar Need Replace Bone Name(Default on)
Aスタンス化、左右足IK、両目ボーン、全ての親ボーン、センターボーン及び親子構造、初期サイズ（10倍）、向き反転
を行います。

・Replace Morph Name(Default on)
VRoid標準のモーフについて、MMD準拠名へ置換します。

・Use Reverse Joint(Default off)
物理演算において逆Jointを追加します。
基本の根本から先端へ伝わる動きに加え
先端の動きが根本へ戻ってくる振動が伝わりやすくなります。

・Emulate Spring Bone Leaf Colider(Default off)
Unity上でのVRMSpringBone（揺れモノ）の先端の当たり判定を正確にPMXに変換します。
通常（Off）は先端が離れすぎると重力に負けて垂れ下がりやすくなるため、先端の配置を再計算しています。

・Use Anti Gravity(非推奨 Default off)
全ての物理剛体を無重力状態（VRMSpringBoneでは重力反映しない設定ができる）にするためのボーンを追加します。
Secondaryボーンを数値入力で10上にずらすと効果を発揮する設計です。

・Bone Dir Modify(Default on)
ボーンの見かけ上の向きを子に向けるようにします。ローカル軸ではありません。
PMXにおいて、見かけ上の向きとローカル軸は別概念です。

・Ca Scaling(Default 14)
出力サイズ倍率です。デフォルトでは14倍します。Vroid基準身長のモデルが、14倍でMMD標準モデルとほぼ同等の身長になります。

◇機能
IKないこともないです。物理ないこともないです。モーフはリネームないかもしれません。

MeshRendererは、親のゲームオブジェクトをボーンとして認識しWeightを100％付与します。
パーツ事に個別のボーンに分たので、親指定を追従させたいボーンにすれば比較的簡単にアクセサリとして書いたパーツを分離できるかも。

テクスチャはメインテクスチャのみ考慮します。
スフィアは指定はしますが、MMDの標準シェーダのバグ回避のため無効化状態反映しています。
xx.Texturesフォルダごとpmxと同階層に"tex"とリネームして配置するとテクスチャが読めます。

材質におけるテクスチャの透過順序は考慮していないのでPMXEditorで修正してください。
材質名の頭にTransparentが付いているものを、それ以外の材質より下に順序変更することで正常な透過が得られるかもしれません。


・更新履歴
v0.1
初版

v0.2
ボーン構造その他Aスタンス化等のMMD標準構造化を実装

v0.2.1
修正:v0.2追加機能においてモーフへの変形が適用されていなかった

v0.2.2
修正:MeshRenderer由来の頂点にボーン位置が反映されていなかった
修正:モーフ翻訳に一部誤植

v0.2.3
修正:モーフ翻訳に一部誤植

v0.2.4
修正:各種データのインデックスサイズ最適化
当修正によりPMXEditorでの再保存が不要でMMDに読み込めるようになります

v0.3
VRMSpringBoneの物理演算への変換を実装
パラメータは一律であり、SpringBoneの設定は各種コライダのサイズのみ反映される

v0.3.2
物理演算パラメータ色々調整
重複させてた剛体とか削除

v0.3.3
ボーンの見かけ上の向きを子に向けるように（ローカル軸ではない※MMDにおいてローカル軸と見かけ上の向きは別概念）
順標準ボーン追加（椀部の捩、親指０）
標準出力スケールを1.4倍化、Vroidデフォルト身長においてMMD標準モデルと同等の身長で出力されるように

v0.3.4
モーフリネームテーブルを外部ファイル化(UTF-8)
BlendShapeProxyで指定されているモーフは別テーブル
また、BlendShapeProxyでグループ化されているモーフが有れば、グループモーフとして変換するように
Vroid男性モデルのモーフリネームテーブルを同梱
材質モーフは現非対応
材質名のヘッダから描画タイプを排除、変わりにRenderQueue値(描画順序)を付与
小さい順に上から並べ替えると良い
なお描画タイプは材質コメント欄へ
MMD標準の材質ではCutOut互換描画はできない